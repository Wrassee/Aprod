Projekt kontextus

Ez a PWA (Progressive Web App) OTIS-protokollok automatiz√°lt kezel√©s√©re szolg√°l.
A frontend React + TypeScript alap√∫, a backend Express + Supabase.
A k√©rd√©sek Excel-sablonb√≥l t√∂lt≈ëdnek be (excelParserService), √©s a backend JSON-ban adja √°t ≈ëket a frontendnek, amely csoportos√≠tva (groupName alapj√°n) rendereli a k√©rd√©seket.

‚öôÔ∏è Jelenlegi √°llapot ‚Äì Funkcion√°lis le√≠r√°s
1. Adatszerkezet

A backend az Excelb≈ël beolvasott k√©rd√©seket √≠gy k√ºldi:

{
  "id": "Q12",
  "titleHu": "K√©rd√©s magyarul",
  "titleDe": "Frage auf Deutsch",
  "groupName": "Biztons√°gi ellen≈ërz√©s",
  "groupNameDe": "Sicherheitspr√ºfung",
  "conditional_group_key": "section_A",
  "type": "yes_no_na",
  ...
}

2. Frontend megjelen√≠t√©s logik√°ja

A React oldalon:

A groupName alapj√°n t√∂rt√©nik a csoportos√≠t√°s: ez hat√°rozza meg a k√©rd√©sblokkot (fejl√©c + k√©rd√©sek).

A conditional_group_key jelzi, hogy egy k√©rd√©s csak akkor jelenjen meg, ha egy el≈ëz≈ë v√°lasz ‚Äûaktiv√°lta‚Äù a kulcsot (pl. ha valaki Igen-t v√°lasztott egy kor√°bbi k√©rd√©sre).

3. Megjelen√≠t√©s

A TrueFalseGroup.tsx komponens felel a blokkok√©rt:

a groupName √©rt√©k√©t haszn√°lja blokkfejl√©cnek (pl. ‚ÄûVillamos ellen≈ërz√©s‚Äù),

a bels≈ë sorok a Questionnaire.tsx √°ltal csoportos√≠tott k√©rd√©seket jelen√≠tik meg.

4. Nyelvi kezel√©s

A useLanguageContext() hook √©s t ford√≠t√°si f√ºggv√©ny biztos√≠tja, hogy a sz√∂veg a felhaszn√°l√≥ √°ltal v√°lasztott nyelven jelenjen meg.
A ford√≠t√°s jelenleg a titleHu, titleDe, groupName, groupNameDe mez≈ëk alapj√°n t√∂rt√©nik.

‚ö†Ô∏è A jelenlegi megold√°s h√°tr√°nyai

Kett≈ës nyelvi strukt√∫ra

K√ºl√∂n mez≈ëk vannak minden nyelvhez (titleHu, titleDe, groupNameDe, stb.).

Ez redund√°ns √©s karbantarthatatlan Excel-szinten is (kett≈ës adatbevitel).

Ford√≠t√°si kontextusok konfliktusban

A useLanguageContext() + t f√ºggv√©ny gyakran √ºtk√∂zik a k√©rd√©sek nyelvi logik√°j√°val, mert a titleHu/titleDe is m√°r lokaliz√°lt.

√çgy a UI k√©tszer is pr√≥b√°lhat ford√≠tani ‚Äì ez bizonyos helyzetekben hib√°t, √ºres mez≈ët vagy kevert nyelv≈± UI-t eredm√©nyez.

groupName t√∫lterhelt funkci√≥

Egyszerre szolg√°l vizu√°lis c√≠mk√©nt √©s logikai azonos√≠t√≥k√©nt (a conditional_group_key-hez is k√∂t≈ëdik).

Ez nehezen b≈ëv√≠thet≈ë, √©s t√∂bbnyelv≈± k√∂rnyezetben inkonzisztens lehet.

Sz≈±r√©s logika bonyolult √©s t√∂r√©keny

A conditional_group_key √©rt√©kek manu√°lisan vannak Excelben be√°ll√≠tva.

A felt√©teles sz≈±r√©s (useConditionalQuestionFilter) a groupName-re is √©p√ºl, √≠gy a logikai √©s vizu√°lis r√©tegek √∂sszemos√≥dnak.

üéØ C√©l ‚Äì Az √∫j, egys√©ges√≠tett strukt√∫ra √©s m≈±k√∂d√©s
1. Egyszer≈±s√≠tett adatmodell

Az Excel √©s backend mez≈ëk √≠gy n√©zzenek ki:

{
  "id": "Q12",
  "title": {
    "hu": "K√©rd√©s magyarul",
    "de": "Frage auf Deutsch"
  },
  "group": {
    "key": "electrical_check",
    "title": {
      "hu": "Villamos ellen≈ërz√©s",
      "de": "Elektrische Pr√ºfung"
    }
  },
  "conditional_key": "section_A",
  "type": "yes_no_na"
}

2. Megjelen√≠t√©si logika

A frontend csak egyetlen title √©s group.title objektumot kezel.

Nincs sz√ºks√©g useLanguageContext() h√≠v√°sra a k√©rd√©sek renderel√©s√©hez:
‚Üí a Questionnaire komponens m√°r az adott nyelvhez megfelel≈ë kulcsot (title[lang]) jelen√≠ti meg.

A groupName √©s conditional_group_key sz√©tv√°lik:

group.key = logikai azonos√≠t√≥

group.title = megjelen√≠t√©si n√©v

conditional_key = felt√©telkapcsolat

3. Backend m√≥dos√≠t√°s

A routes.ts form√°z√°sban:

T√∂r√∂lni kell a groupNameDe, titleHu, titleDe stb. mez≈ëket.

√öj strukt√∫r√°t kell √©p√≠teni az Excel-olvas√°s ut√°n:

title: { hu: config.titleHu, de: config.titleDe },
group: {
  key: config.groupKey || config.groupName,
  title: { hu: config.groupName, de: config.groupNameDe }
}


A frontendnek mindig ugyanaz a JSON-strukt√∫ra megy vissza.

4. Frontend m√≥dos√≠t√°s

TrueFalseGroup.tsx ‚Üí csak a group.title[lang] mez≈ët jelen√≠tse meg.

useConditionalQuestionFilter.tsx ‚Üí a conditional_key mez≈ët haszn√°lja, ne a groupName-t.

A Questionnaire.tsx ‚Üí a group.key alapj√°n csoportos√≠tson.

üí° El≈ënyei az √∫j megold√°snak
Szempont	Jelenlegi rendszer	√öj rendszer
Nyelvi kezel√©s	Duplik√°lt mez≈ëk (titleHu, titleDe)	Egys√©ges title: { hu, de }
Ford√≠t√°s	F√ºgg a useLanguageContext()-t√≥l	Nyelvf√ºggetlen, backendb≈ël j√∂n a megfelel≈ë sz√∂veg
Csoportos√≠t√°s	groupName keveri a logik√°t √©s megjelen√≠t√©st	group.key √©s group.title k√ºl√∂nv√°lik
Felt√©teles logika	groupName-hez k√∂t√∂tt	conditional_key √∂n√°ll√≥, tiszta
Excel-kezel√©s	T√∂bbsz√∂r√∂s adatbevitel	Egy helyen szerkeszthet≈ë
Hibalehet≈ës√©g	Magas (kett≈ës ford√≠t√°s)	Alacsony (egys√©ges strukt√∫ra)
ü™ú Fejleszt√©si l√©p√©sek (a Replit-asszisztens sz√°m√°ra)

Backend refaktor (routes.ts)

A k√©rd√©sform√°z√≥ r√©szt alak√≠tsd √°t a fenti strukt√∫r√°ra.

T√∂r√∂ld a groupNameDe, titleHu, titleDe mez≈ëket a response-b√≥l.

√öj kulcsok: title.hu, title.de, group.key, group.title.hu, group.title.de.

Frontend m√≥dos√≠t√°s

Questionnaire.tsx:

Csoportos√≠t√°s group.key szerint, fejl√©c megjelen√≠t√©s group.title[lang].

TrueFalseGroup.tsx:

Fejl√©cben group.title[lang] haszn√°lata.

A t ford√≠t√°si f√ºggv√©ny elt√°vol√≠that√≥ a k√©rd√©sekhez.

useConditionalQuestionFilter.tsx:

A conditional_key alapj√°n sz≈±rj, ne groupName alapj√°n.

Excel Parser friss√≠t√©s

A excelParserService-ben √©p√≠tsd be, hogy groupKey mez≈ët is gener√°ljon (pl. slug form√°ban a groupName alapj√°n).

Transzform√°ci√≥s kompatibilit√°s

Ideiglenesen t√°mogasd a r√©gi mez≈ëket is (fallback), hogy ne t√∂rj√∂n az app:

title: { hu: config.titleHu || config.title, de: config.titleDe || config.title },